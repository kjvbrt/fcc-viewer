"use strict";(self.webpackChunkFCCViewer=self.webpackChunkFCCViewer||[]).push([[518],{1518:(z,y,c)=>{c.d(y,{n:()=>b});var B=c(8428),_=c(628);function d(f){"ROOT::Experimental::RAxisEquidistant"==f._typename||"ROOT::Experimental::RAxisLabels"==f._typename?(0===f.fInvBinWidth&&(f.$dummy=!0,f.fInvBinWidth=1,f.fNBinsNoOver=0,f.fLow=0),f.min=f.fLow,f.max=f.fLow+f.fNBinsNoOver/f.fInvBinWidth,f.GetNumBins=function(){return this.fNBinsNoOver},f.GetBinCoord=function(i){return this.fLow+i/this.fInvBinWidth},f.FindBin=function(i,n){return Math.floor((i-this.fLow)*this.fInvBinWidth+n)}):"ROOT::Experimental::RAxisIrregular"==f._typename&&(f.min=f.fBinBorders[0],f.max=f.fBinBorders[f.fBinBorders.length-1],f.GetNumBins=function(){return this.fBinBorders.length},f.GetBinCoord=function(i){let n=Math.round(i);if(n<=0)return this.fBinBorders[0];if(n>=this.fBinBorders.length)return this.fBinBorders[this.fBinBorders.length-1];if(n==i)return this.fBinBorders[n];let t=i<n?n-1:n+1;return this.fBinBorders[n]*Math.abs(i-t)+this.fBinBorders[t]*Math.abs(i-n)},f.FindBin=function(i,n){for(let t=1;t<this.fBinBorders.length;++t)if(i<this.fBinBorders[t])return Math.floor(t-1+n);return this.fBinBorders.length-1}),f.GetBinCenter=function(i){return this.GetBinCoord(i-.5)},f.GetBinLowEdge=function(i){return this.GetBinCoord(i-1)}}function m(f){return f&&f.fHistImpl?f.fHistImpl.fIO:null}class b extends _.p{constructor(i,n){super(i,n),this.csstype="hist",this.draw_content=!0,this.nbinsx=0,this.nbinsy=0,this.accept_drops=!0,this.mode3d=!1,this.getHisto(!0)}isDisplayItem(){let i=this.getObject();return!(!i||!i.fAxes)}getHisto(i){let n=this.getObject(),t=m(n);return!t||t.getBinContent&&!i?!t&&n&&n.fAxes&&(t=n,(!t.getBinContent||i)&&(3==t.fAxes.length?(d(t.fAxes[0]),d(t.fAxes[1]),d(t.fAxes[2]),t.nx=t.fIndicies[1]-t.fIndicies[0],t.dx=t.fIndicies[0]+1,t.stepx=t.fIndicies[2],t.ny=t.fIndicies[4]-t.fIndicies[3],t.dy=t.fIndicies[3]+1,t.stepy=t.fIndicies[5],t.nz=t.fIndicies[7]-t.fIndicies[6],t.dz=t.fIndicies[6]+1,t.stepz=t.fIndicies[8],t.getBin=function(s,o,r){return s-1+this.fAxes[0].GetNumBins()*(o-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*(r-1)},t.getBin0=t.stepx>1||t.stepy>1||t.stepz>1?function(s,o,r){return Math.floor((s-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((o-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((r-this.dz)/this.stepz)}:function(s,o,r){return s-this.dx+this.nx*(o-this.dy)+this.nx*this.ny*(r-dz)},t.getBinContent=function(s,o,r){return this.fBinContent[this.getBin0(s,o,r)]},t.getBinError=function(s,o,r){return Math.sqrt(Math.abs(this.getBinContent(s,o,r)))}):2==t.fAxes.length?(d(t.fAxes[0]),d(t.fAxes[1]),t.nx=t.fIndicies[1]-t.fIndicies[0],t.dx=t.fIndicies[0]+1,t.stepx=t.fIndicies[2],t.ny=t.fIndicies[4]-t.fIndicies[3],t.dy=t.fIndicies[3]+1,t.stepy=t.fIndicies[5],t.getBin=function(s,o){return s-1+this.fAxes[0].GetNumBins()*(o-1)},t.getBin0=t.stepx>1||t.stepy>1?function(s,o){return Math.floor((s-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((o-this.dy)/this.stepy)}:function(s,o){return s-this.dx+this.nx*(o-this.dy)},t.getBinContent=function(s,o){return this.fBinContent[this.getBin0(s,o)]},t.getBinError=function(s,o){return Math.sqrt(Math.abs(this.getBinContent(s,o)))}):(d(t.fAxes[0]),t.nx=t.fIndicies[1]-t.fIndicies[0],t.dx=t.fIndicies[0]+1,t.stepx=t.fIndicies[2],t.getBin=function(s){return s-1},t.getBin0=t.stepx>1?function(s){return Math.floor((s-this.dx)/this.stepx)}:function(s){return s-this.dx},t.getBinContent=function(s){return this.fBinContent[this.getBin0(s)]},t.getBinError=function(s){return Math.sqrt(Math.abs(this.getBinContent(s)))}))):t.fAxes._2?(d(t.fAxes._0),d(t.fAxes._1),d(t.fAxes._2),t.getBin=function(s,o,r){return s-1+this.fAxes._0.GetNumBins()*(o-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(r-1)},t.getBinContent=function(s,o,r){return this.fStatistics.fBinContent[this.getBin(s,o,r)]},t.getBinError=function(s,o,r){let h=this.getBin(s,o,r);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[h]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[h]))}):t.fAxes._1?(d(t.fAxes._0),d(t.fAxes._1),t.getBin=function(s,o){return s-1+this.fAxes._0.GetNumBins()*(o-1)},t.getBinContent=function(s,o){return this.fStatistics.fBinContent[this.getBin(s,o)]},t.getBinError=function(s,o){let r=this.getBin(s,o);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[r]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[r]))}):(d(t.fAxes._0),t.getBin=function(s){return s-1},t.getBinContent=function(s){return this.fStatistics.fBinContent[s-1]},t.getBinError=function(s){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[s-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[s-1]))}),t}decodeOptions(){this.options||(this.options={Hist:1})}copyOptionsFrom(i){i!==this&&(this.options.Mode3D=i.options.Mode3D)}copyOptionsToOthers(){this.forEachPainter(i=>{i!==this&&"function"==typeof i.copyOptionsFrom&&i.copyOptionsFrom(this)},"objects")}clear3DScene(){let i=this.getFramePainter();"function"==typeof i?.create3DScene&&i.create3DScene(-1),this.mode3d=!1}cleanup(){this.clear3DScene(),delete this.options,super.cleanup()}getDimension(){return 1}scanContent(){}drawFrameAxes(){let i=this.getFramePainter();return i?this.draw_content?this.isMainPainter()?(i.cleanupAxes(),i.xmin=i.xmax=0,i.ymin=i.ymax=0,i.zmin=i.zmax=0,i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),i.drawAxes()):this.options.second_x||this.options.second_y?(i.setAxes2Ranges(this.options.second_x,this.getAxis("x"),this.xmin,this.xmax,this.options.second_y,this.getAxis("y"),this.ymin,this.ymax),i.drawAxes2(this.options.second_x,this.options.second_y)):Promise.resolve(!0):Promise.resolve(!0):Promise.resolve(!1)}createHistDrawAttributes(){this.createv7AttFill(),this.createv7AttLine()}updateDisplayItem(i,n){return!(!i||!n||(i.fAxes=n.fAxes,i.fIndicies=n.fIndicies,i.fBinContent=n.fBinContent,i.fContMin=n.fContMin,i.fContMinPos=n.fContMinPos,i.fContMax=n.fContMax,this.getHisto(!0),0))}updateObject(i){let n=this.getObject();if(i!==n){if(!this.matchObjectType(i))return!1;if(this.isDisplayItem())this.updateDisplayItem(n,i);else{let t=m(n),s=m(i);if(!t||!s)return!1;t.fStatistics=s.fStatistics,n.fTitle=i.fTitle}}return this.scanContent(),this.histogram_updated=!0,!0}getAxis(i){let n=this.getHisto(),t=this.getObject(),s=null;if(t&&t.fAxes)switch(i){case"x":default:s=t.fAxes[0];break;case"y":s=t.fAxes[1];break;case"z":s=t.fAxes[2]}else if(n&&n.fAxes)switch(i){case"x":default:s=n.fAxes._0;break;case"y":s=n.fAxes._1;break;case"z":s=n.fAxes._2}return s&&!s.GetBinCoord&&d(s),s}getAxisBinTip(i,n,t){let s=this.getFramePainter(),o=s[i+"_handle"],r=this.getAxis(i),h=r.GetBinCoord(n);if("labels"===o.kind)return s.axisAsText(i,h);let a=r.GetBinCoord(n+(t||1));return"time"===o.kind?s.axisAsText(i,(h+a)/2):"["+s.axisAsText(i,h)+", "+s.axisAsText(i,a)+")"}extractAxesProperties(i){if(!this.getHisto())return;this.nbinsx=this.nbinsy=this.nbinsz=0;let t=this.getAxis("x");this.nbinsx=t.GetNumBins(),this.xmin=t.min,this.xmax=t.max,!(i<2)&&(t=this.getAxis("y"),this.nbinsy=t.GetNumBins(),this.ymin=t.min,this.ymax=t.max,!(i<3)&&(t=this.getAxis("z"),this.nbinsz=t.GetNumBins(),this.zmin=t.min,this.zmax=t.max))}addInteractivity(){let i=this.isMainPainter(),n=this.options.second_x||this.options.second_y,t=i||n?this.getFramePainter():null;return!t||t.addInteractivity(!i&&n)}processItemReply(i,n){if(!this.isDisplayItem())return console.error("Get item when display normal histogram");n.reqid===this.current_item_reqid&&(null!==i&&this.updateDisplayItem(this.getObject(),i.item),n.resolveFunc(!0))}drawingBins(i){let n=!1;return i&&"string"==typeof i&&0==i.indexOf("zoom")&&(i.indexOf("0")>0&&(n=!0),this.getDimension()>1&&i.indexOf("1")>0&&(n=!0),this.getDimension()>2&&i.indexOf("2")>0&&(n=!0)),this.isDisplayItem()&&n&&this.v7NormalMode()&&this.prepareDraw({only_indexes:!0}).incomplete?new Promise(s=>{let o=this.v7SubmitRequest("",{_typename:"ROOT::Experimental::RHistDrawableBase::RRequest"},this.processItemReply.bind(this));o?(this.current_item_reqid=o.reqid,o.resolveFunc=s,setTimeout(this.processItemReply.bind(this,null,o),1e3)):s(!0)}):Promise.resolve(!0)}toggleStat(){}getSelectIndex(i,n,t){let s=0,o=this.getAxis(i),r=this["nbins"+i]||0;this.options.second_x&&"x"==i&&(i="x2"),this.options.second_y&&"y"==i&&(i="y2");let h=this.getFramePainter(),a=h?h["zoom_"+i+"min"]:0,u=h?h["zoom_"+i+"max"]:0;return a!==u&&o?(s="left"==n?o.FindBin(a,t||0):o.FindBin(u,(t||0)+.5),s<0?s=0:s>r&&(s=r)):s="left"==n?0:r,s}autoZoom(){}clickButton(i){switch(i){case"ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax)return this.unzoom(),this.getFramePainter().zoomChangedInteractive("reset"),!0;if(this.draw_content)return this.autoZoom(),!0;break;case"ToggleLogX":this.getFramePainter().toggleAxisLog("x");break;case"ToggleLogY":this.getFramePainter().toggleAxisLog("y");break;case"ToggleLogZ":this.getFramePainter().toggleAxisLog("z");break;case"ToggleStatBox":return this.toggleStat(),!0}return!1}fillToolbar(i){let n=this.getPadPainter();!n||(n.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),n.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),n.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),this.getDimension()>1&&n.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&n.addPadButton("statbox","Toggle stat box","ToggleStatBox"),i||n.showPadButtons())}get3DToolTip(i){let n=this.getHisto(),t={bin:i,name:n.fName||"histo",title:n.fTitle};switch(this.getDimension()){case 1:t.ix=i+1,t.iy=1,t.value=n.getBinContent(t.ix),t.error=n.getBinError(t.ix),t.lines=this.getBinTooltips(i-1);break;case 2:t.ix=i%this.nbinsx+1,t.iy=(i-(t.ix-1))/this.nbinsx+1,t.value=n.getBinContent(t.ix,t.iy),t.error=n.getBinError(t.ix,t.iy),t.lines=this.getBinTooltips(t.ix-1,t.iy-1);break;case 3:t.ix=i%this.nbinsx+1,t.iy=(i-(t.ix-1))/this.nbinsx%this.nbinsy+1,t.iz=(i-(t.ix-1)-(t.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+1,t.value=n.getBinContent(t.ix,t.iy,t.iz),t.error=n.getBinError(t.ix,t.iy,t.iz),t.lines=this.getBinTooltips(t.ix-1,t.iy-1,t.iz-1)}return t}createContour(i,n,t){if(!i||!n)return;t||(t={});let s=B.gStyle.fNumberContours,o=this.minbin,r=this.maxbin,h=this.minposbin;t.scatter_plot&&(s>50&&(s=50),o=this.minposbin),o===r&&(o=this.gminbin,r=this.gmaxbin,h=this.gminposbin),this.getDimension()<3&&(i.zoom_zmin!==i.zoom_zmax?(o=i.zoom_zmin,r=i.zoom_zmax):t.full_z_range&&(o=i.zmin,r=i.zmax)),n.setFullRange(i.zmin,i.zmax),n.createContour(i.logz,s,o,r,h),this.getDimension()<3&&(i.scale_zmin=n.colzmin,i.scale_zmax=n.colzmax)}changeValuesRange(i,n){let t=this.getFramePainter();if(!t)return;let s=t.isAxisZoomed(n)?"zoom_"+n:n;i.input("Enter values range for axis "+n+" like [0,100] or empty string to unzoom","["+t[s+"min"]+","+t[s+"max"]+"]").then(r=>{(r=r?JSON.parse(r):[])&&"object"==typeof r&&2==r.length&&Number.isFinite(r[0])&&Number.isFinite(r[1])?t.zoom(n,r[0],r[1]):t.unzoom(n)})}fillContextMenu(i){i.add("header:v7histo::anyname"),this.draw_content&&(i.addchk(this.toggleStat("only-check"),"Show statbox",()=>this.toggleStat()),2==this.getDimension()&&i.add("Values range",()=>this.changeValuesRange(i,"z")),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(i));let n=this.getFramePainter();if(this.options.Mode3D){i.size()>0&&i.add("separator");let t=this.getMainPainter()||this;i.addchk(t.isTooltipAllowed(),"Show tooltips",()=>t.setTooltipAllowed("toggle")),i.addchk(n.enable_highlight,"Highlight bins",()=>{n.enable_highlight=!n.enable_highlight,!n.enable_highlight&&t.highlightBin3D&&t.mode3d&&t.highlightBin3D(null)}),"function"==typeof n?.render3D&&(i.addchk(t.options.FrontBox,"Front box",()=>{t.options.FrontBox=!t.options.FrontBox,n.render3D()}),i.addchk(t.options.BackBox,"Back box",()=>{t.options.BackBox=!t.options.BackBox,n.render3D()})),this.draw_content&&(i.addchk(!this.options.Zero,"Suppress zeros",()=>{this.options.Zero=!this.options.Zero,this.redrawPad()}),(12==this.options.Lego||14==this.options.Lego)&&this.fillPaletteMenu&&this.fillPaletteMenu(i)),"function"==typeof t.control?.reset&&i.add("Reset camera",()=>t.control.reset())}return i.addAttributesMenu(this),this.histogram_updated&&n.zoomChangedInteractive()&&i.add("Let update zoom",()=>n.zoomChangedInteractive("reset")),!0}updatePaletteDraw(){this.isMainPainter()&&this.getPadPainter().findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable")?.drawPalette()}fillPaletteMenu(i){i.addPaletteMenu(this.options.Palette||B.settings.Palette,n=>{this.options.Palette=parseInt(n),this.redraw()})}toggleMode3D(){this.options.Mode3D=!this.options.Mode3D,this.options.Mode3D&&!this.options.Surf&&!this.options.Lego&&!this.options.Error&&(this.options.Lego=this.nbinsx>=50||this.nbinsy>=50?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1),this.copyOptionsToOthers(),this.interactiveRedraw("pad","drawopt")}prepareDraw(i){i||(i={rounding:!0,extra:0,middle:0}),void 0===i.extra&&(i.extra=0),void 0===i.right_extra&&(i.right_extra=i.extra),void 0===i.middle&&(i.middle=0);let h,a,u,x,l,p,n=this.getHisto(),t=this.getAxis("x"),s=this.getAxis("y"),o=this.getFramePainter(),r=this.getDimension(),e={i1:this.getSelectIndex("x","left",0-i.extra),i2:this.getSelectIndex("x","right",1+i.right_extra),j1:r<2?0:this.getSelectIndex("y","left",0-i.extra),j2:r<2?1:this.getSelectIndex("y","right",1+i.right_extra),k1:r<3?0:this.getSelectIndex("z","left",0-i.extra),k2:r<3?1:this.getSelectIndex("z","right",1+i.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};if(this.isDisplayItem()&&n.fIndicies&&(e.i1<n.fIndicies[0]&&(e.i1=n.fIndicies[0],e.incomplete=!0),e.i2>n.fIndicies[1]&&(e.i2=n.fIndicies[1],e.incomplete=!0),e.stepi=n.fIndicies[2],e.stepi>1&&(e.incomplete=!0),r>1&&n.fIndicies.length>5&&(e.j1<n.fIndicies[3]&&(e.j1=n.fIndicies[3],e.incomplete=!0),e.j2>n.fIndicies[4]&&(e.j2=n.fIndicies[4],e.incomplete=!0),e.stepj=n.fIndicies[5],e.stepj>1&&(e.incomplete=!0)),r>2&&n.fIndicies.length>8&&(e.k1<n.fIndicies[6]&&(e.k1=n.fIndicies[6],e.incomplete=!0),e.k2>n.fIndicies[7]&&(e.k2=n.fIndicies[7],e.incomplete=!0),e.stepk=n.fIndicies[8],e.stepk>1&&(e.incomplete=!0))),i.only_indexes)return e;e.grx=new Array(e.i2+e.stepi+1),e.gry=new Array(e.j2+e.stepj+1),i.original&&(e.original=!0,e.origx=new Array(e.i2+1),e.origy=new Array(e.j2+1)),i.pixel_density&&(i.rounding=!0);let g=o.getGrFuncs(this.options.second_x,this.options.second_y);for(h=e.i1;h<=e.i2;++h)u=t.GetBinCoord(h+i.middle),g.logx&&u<=0?e.i1=h+1:(e.origx&&(e.origx[h]=u),e.grx[h]=g.grx(u),i.rounding&&(e.grx[h]=Math.round(e.grx[h])),i.use3d&&(e.grx[h]<-o.size_x3d&&(e.i1=h,e.grx[h]=-o.size_x3d),e.grx[h]>o.size_x3d&&(e.i2=h,e.grx[h]=o.size_x3d)));for(i.use3d&&(e.i1<e.i2-2&&e.grx[e.i1]==e.grx[e.i1+1]&&e.i1++,e.i1<e.i2-2&&e.grx[e.i2-1]==e.grx[e.i2]&&e.i2--);h<e.i2+e.stepi+1;)e.grx[h++]=e.grx[e.i2];if(1===r)e.gry[0]=g.gry(0),e.gry[1]=g.gry(1);else for(a=e.j1;a<=e.j2;++a)x=s.GetBinCoord(a+i.middle),g.logy&&x<=0?e.j1=a+1:(e.origy&&(e.origy[a]=x),e.gry[a]=g.gry(x),i.rounding&&(e.gry[a]=Math.round(e.gry[a])),i.use3d&&(e.gry[a]<-o.size_y3d&&(e.j1=a,e.gry[a]=-o.size_y3d),e.gry[a]>o.size_y3d&&(e.j2=a,e.gry[a]=o.size_y3d)));for(i.use3d&&r>1&&(e.j1<e.j2-2&&e.gry[e.j1]==e.gry[e.j1+1]&&e.j1++,e.j1<e.j2-2&&e.gry[e.j2-1]==e.gry[e.j2]&&e.j2--);r>1&&a<e.j2+e.stepj+1;)e.gry[a++]=e.gry[e.j2];for(this.maxbin=this.minbin=this.minposbin=null,h=e.i1;h<e.i2;h+=e.stepi)for(a=e.j1;a<e.j2;a+=e.stepj)if(l=n.getBinContent(h+1,a+1),Number.isFinite(l)){if(e.sumz+=l,i.pixel_density){if(p=(e.grx[h+e.stepi]-e.grx[h])*(e.gry[a]-e.gry[a+e.stepj]),p<=0)continue;e.max=Math.max(e.max,l),l>0&&(l<e.min||0===e.min)&&(e.min=l),l/=p}null===this.maxbin?this.maxbin=this.minbin=l:(this.maxbin=Math.max(this.maxbin,l),this.minbin=Math.min(this.minbin,l)),l>0&&(null===this.minposbin||l<this.minposbin)&&(this.minposbin=l)}return e.palette=o.getHistPalette(),e.palette&&this.createContour(o,e.palette,i),e}}}}]);