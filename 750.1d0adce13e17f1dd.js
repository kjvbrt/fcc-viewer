"use strict";(self.webpackChunkFCCViewer=self.webpackChunkFCCViewer||[]).push([[750],{5750:(Mt,gt,F)=>{F.r(gt),F.d(gt,{RH3Painter:()=>J,drawHistDisplayItem:()=>Ct});var xt=F(8428),O=F(7983),ft=F(2944),yt=F(7527),bt=F(9232),wt=F(1518),H=F(8802),zt=F(7453),At=F(7958),Bt=F(8415);class J extends wt.n{getDimension(){return 3}scanContent(t){if(t&&this.nbinsx&&this.nbinsy&&this.nbinsz)return;let i=this.getHisto();if(i){if(this.extractAxesProperties(3),this.isDisplayItem())this.gminbin=i.fContMin,this.gminposbin=i.fContMinPos>0?i.fContMinPos:null,this.gmaxbin=i.fContMax;else{this.gminbin=this.gmaxbin=i.getBinContent(1,1,1);for(let e=0;e<this.nbinsx;++e)for(let n=0;n<this.nbinsy;++n)for(let o=0;o<this.nbinsz;++o){let h=i.getBinContent(e+1,n+1,o+1);h<this.gminbin?this.gminbin=h:h>this.gmaxbin&&(this.gmaxbin=h)}}this.draw_content=this.gmaxbin>0}}countStat(){let M,v,T,S,j,K,X,Z,G,E,t=this.getHisto(),i=this.getAxis("x"),e=this.getAxis("y"),n=this.getAxis("z"),o=0,h=0,l=0,x=0,g=0,m=0,p=0,B=this.getSelectIndex("x","left"),c=this.getSelectIndex("x","right"),f=this.getSelectIndex("y","left"),d=this.getSelectIndex("y","right"),y=this.getSelectIndex("z","left"),C=this.getSelectIndex("z","right"),I=this.getFramePainter(),_={name:t.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0};for(M=1;M<=this.nbinsx;++M)for(S=i.GetBinCoord(M-.5),j=M<=B+1?0:M>c+1?2:1,v=1;v<=this.nbinsy;++v)for(K=e.GetBinCoord(v-.5),X=v<=f+1?0:v>d+1?2:1,T=1;T<=this.nbinsz;++T)Z=n.GetBinCoord(T-.5),G=T<=y+1?0:T>C+1?2:1,E=t.getBinContent(M,v,T),_.entries+=E,1==j&&1==X&&1==G&&(o+=E,h+=S*E,l+=K*E,x+=Z*E,g+=S**2*E,m+=K**2*E,p+=Z**2*E);return t.fTsumw>0&&!I.isAxisZoomed("x")&&!I.isAxisZoomed("y")&&!I.isAxisZoomed("z")&&(o=t.fTsumw,h=t.fTsumwx,g=t.fTsumwx2,l=t.fTsumwy,m=t.fTsumwy2,x=t.fTsumwz,p=t.fTsumwz2),o>0&&(_.meanx=h/o,_.meany=l/o,_.meanz=x/o,_.rmsx=Math.sqrt(Math.abs(g/o-_.meanx**2)),_.rmsy=Math.sqrt(Math.abs(m/o-_.meany**2)),_.rmsz=Math.sqrt(Math.abs(p/o-_.meanz**2))),_.integral=o,t.fEntries>1&&(_.entries=t.fEntries),_}fillStatistic(t,i){let e=this.countStat(),n=i%10,o=Math.floor(i/10)%10,h=Math.floor(i/100)%10,l=Math.floor(i/1e3)%10,x=Math.floor(i/1e6)%10;return t.clearStat(),n>0&&t.addText(e.name),o>0&&t.addText("Entries = "+t.format(e.entries,"entries")),h>0&&(t.addText("Mean x = "+t.format(e.meanx)),t.addText("Mean y = "+t.format(e.meany)),t.addText("Mean z = "+t.format(e.meanz))),l>0&&(t.addText("Std Dev x = "+t.format(e.rmsx)),t.addText("Std Dev y = "+t.format(e.rmsy)),t.addText("Std Dev z = "+t.format(e.rmsz))),x>0&&t.addText("Integral = "+t.format(e.integral,"entries")),!0}getBinTooltips(t,i,e){let n=[],o=this.getHisto(),h=1,l=1,x=1;this.isDisplayItem()&&(h=o.stepx||1,l=o.stepy||1,x=o.stepz||1),n.push(this.getObjectHint()),n.push("x = "+this.getAxisBinTip("x",t,h)+"  xbin="+t),n.push("y = "+this.getAxisBinTip("y",i,l)+"  ybin="+i),n.push("z = "+this.getAxisBinTip("z",e,x)+"  zbin="+e);let g=o.getBinContent(t+1,i+1,e+1),m="entries = "+(h>1||l>1||x>1?"~":"");return g===Math.round(g)?n.push(m+g):n.push(m+(0,ft.Ee)(g,xt.gStyle.fStatFormat)),n}draw3DScatter(t){let c,f,d,y,i=this.getHisto(),e=this.getFramePainter(),n=t.i1,o=t.i2,h=t.stepi,l=t.j1,x=t.j2,g=t.stepj,m=t.k1,p=t.k2,B=t.stepk;if(o<=n||x<=l||p<=m)return Promise.resolve(!0);let C=this.gmaxbin>1e3?1e3/this.gmaxbin:1,I=0,_=0,M=Math.max(0,this.gminbin);for(c=n;c<o;c+=h)for(f=l;f<x;f+=g)for(d=m;d<p;d+=B)y=i.getBinContent(c+1,f+1,d+1),_+=y,!(y<=M)&&(I+=Math.round(y*C));if(I>(e.webgl?1e5:3e4))return Promise.resolve(!1);let v=new H.B_(I,e.webgl,e.size_x3d/200),T=new Int32Array(I),S=0,j=this.getAxis("x"),K=this.getAxis("y"),X=this.getAxis("z"),Z=new ft.q9(_);for(c=n;c<o;c+=h)for(f=l;f<x;f+=g)for(d=m;d<p;d+=B){if(y=i.getBinContent(c+1,f+1,d+1),y<=M)continue;let G=Math.round(y*C);for(let E=0;E<G;++E){let b=j.GetBinCoord(c+Z.random()),w=K.GetBinCoord(f+Z.random()),P=X.GetBinCoord(d+Z.random());T[S++]=i.getBin(c+1,f+1,d+1),v.addPoint(e.grx(b),e.gry(w),e.grz(P))}}return v.createPoints({color:this.v7EvalColor("fill_color","red")}).then(G=>(e.toplevel.add(G),G.bins=T,G.painter=this,G.tip_color=65280,G.tooltip=function(E){if(!Number.isInteger(E.index))return console.error(`intersect.index not provided, three.js version ${O.UZH}`),null;let b=Math.floor(E.index/this.nvertex);if(b<0||b>=this.bins.length)return null;let w=this.painter,P=w.getFramePainter(),u=w.get3DToolTip(this.bins[b]);return u.x1=P.grx(w.getAxis("x").GetBinLowEdge(u.ix)),u.x2=P.grx(w.getAxis("x").GetBinLowEdge(u.ix+h)),u.y1=P.gry(w.getAxis("y").GetBinLowEdge(u.iy)),u.y2=P.gry(w.getAxis("y").GetBinLowEdge(u.iy+g)),u.z1=P.grz(w.getAxis("z").GetBinLowEdge(u.iz)),u.z2=P.grz(w.getAxis("z").GetBinLowEdge(u.iz+B)),u.color=this.tip_color,u.opacity=.3,u},!0))}draw3DBins(t){let m,p,i=this.v7EvalColor("fill_color","red"),e=this.getFramePainter(),n=0,o=!1,h=!1,l=!1,x=1,g=!0,B=.5;if(this.options.Sphere){B=.4,o=!0,11===this.options.Sphere&&(l=!0);let a=e.webgl?new O.xo$(.5,16,12):new O.xo$(.5,8,6);a.applyMatrix4((new O.yGw).makeRotationX(Math.PI/2)),a.computeVertexNormals();let r=a.getIndex().array,k=a.getAttribute("position").array,A=a.getAttribute("normal").array;n=3*r.length,m=new Float32Array(n),p=new Float32Array(n);for(let s=0;s<r.length;++s){let z=3*r[s];m[3*s]=k[z],m[3*s+1]=k[z+1],m[3*s+2]=k[z+2],p[3*s]=A[z],p[3*s+1]=A[z+1],p[3*s+2]=A[z+2]}}else{let a=H.XZ.Indexes,r=H.XZ.Normals,k=H.XZ.Vertices;n=3*a.length,m=new Float32Array(n),p=new Float32Array(n);for(let A=0,s=-3;A<a.length;++A){let z=k[a[A]];m[3*A]=z.x-.5,m[3*A+1]=z.y-.5,m[3*A+2]=z.z-.5,A%6==0&&(s+=3),p[3*A]=r[s],p[3*A+1]=r[s+1],p[3*A+2]=r[s+2]}h=!0,11==this.options.Box?l=!0:12==this.options.Box?(l=!0,h=!1):this.options.Color&&(l=!0,x=.5,g=!1,h=!1,o=!0)}g&&(g=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);let c=this.getHisto(),f=t.i1,d=t.i2,y=t.stepi,C=t.j1,I=t.j2,_=t.stepj,M=t.k1,v=t.k2,T=t.stepk,S=null;if(l&&(S=e.getHistPalette(),this.createContour(e,S)),d<=f||I<=C||v<=M)return!0;let w,P,u,W,U,j=this.getAxis("x"),K=this.getAxis("y"),X=this.getAxis("z"),Z=(e.grx(j.GetBinCoord(d))-e.grx(j.GetBinCoord(f)))/(d-f)*y,G=(e.gry(K.GetBinCoord(I))-e.gry(K.GetBinCoord(C)))/(I-C)*_,E=(e.grz(X.GetBinCoord(v))-e.grz(X.GetBinCoord(M)))/(v-M)*T,b=0,N=[],V=0,Y=[];for(w=f;w<d;w+=y)for(P=C;P<I;P+=_)for(u=M;u<v;u+=T){if(U=c.getBinContent(w+1,P+1,u+1),!this.options.Color&&(0===U||U<this.gminbin)||(W=g?Math.pow(Math.abs(U*g),.3333):1,W<.001)||(b++,!l))continue;let a=S.getContourIndex(U);a>=0?(void 0===N[a]&&(N[a]=0,Y[a]=V++),N[a]+=1):console.error("not found color for",U)}l||(N.push(b),V=1,Y=[0]);let dt,ot,mt,at,ut,lt,et=new Array(V),q=new Array(V),it=new Array(V),nt=new Array(V),$=new Array(V),st=new Array(V),rt=new Array(V);for(let a=0;a<N.length;++a){if(!N[a])continue;b=N[a];let r=Y[a];et[r]=0,$[r]=0,h&&($[r]=b*n/3>65520?2:1),q[r]=new Float32Array(b*n),it[r]=new Float32Array(b*n),nt[r]=new Int32Array(b),1===$[r]&&(st[r]=new Uint16Array(b*H.XZ.MeshSegments.length)),2===$[r]&&(rt[r]=new Float32Array(b*H.XZ.Segments.length*3))}for(j=this.getAxis("x"),K=this.getAxis("y"),X=this.getAxis("z"),w=f;w<d;w+=y)for(dt=j.GetBinCenter(w+1),ot=e.grx(dt),P=C;P<I;P+=_)for(mt=K.GetBinCenter(P+1),at=e.gry(mt),u=M;u<v;u+=T){if(U=c.getBinContent(w+1,P+1,u+1),!this.options.Color&&(0===U||U<this.gminbin)||(W=g?Math.pow(Math.abs(U*g),.3333):1,W<.001))continue;let a=0;if(l){let s=S.getContourIndex(U);if(s<0)continue;a=Y[s]}b=et[a],ut=X.GetBinCenter(u+1),lt=e.grz(ut),nt[a][b]=c.getBin(w+1,P+1,u+1);let r=b*n,k=q[a],A=it[a];for(let s=0;s<n;s+=3,r+=3)k[r]=ot+m[s]*Z*W,k[r+1]=at+m[s+1]*G*W,k[r+2]=lt+m[s+2]*E*W,A[r]=p[s],A[r+1]=p[s+1],A[r+2]=p[s+2];if(1===$[a]){let s=H.XZ.MeshSegments;r=b*s.length;let z=Math.round(b*n/3),R=st[a];for(let D=0;D<s.length;++D)R[r+D]=z+s[D]}if(2===$[a]){let s=H.XZ.Segments,z=rt[a];r=b*s.length*3;for(let R=0;R<s.length;++R,r+=3){let D=H.XZ.Vertices[s[R]];z[r]=ot+(D.x-.5)*Z*W,z[r+1]=at+(D.y-.5)*G*W,z[r+2]=lt+(D.z-.5)*E*W}}et[a]=b+1}for(let a=0;a<N.length;++a){if(!N[a])continue;let r=Y[a],k=new O.u9r;k.setAttribute("position",new O.TlE(q[r],3)),k.setAttribute("normal",new O.TlE(it[r],3)),l&&(i=S.getColor(a));let A=o?new O.YBo({color:i,opacity:x,transparent:x<1,vertexColors:!1}):new O.vBJ({color:i,opacity:x,vertexColors:!1}),s=new O.Kj0(k,A);if(s.bins=nt[r],s.bins_faces=n/9,s.painter=this,s.scalex=B*Z,s.scaley=B*G,s.scalez=B*E,s.tip_color=65280,s.use_scale=g,s.tooltip=function(z){if(!Number.isInteger(z.faceIndex))return console.error(`intersect.faceIndex not provided, three.js version ${O.UZH}`),null;let R=Math.floor(z.faceIndex/this.bins_faces);if(R<0||R>=this.bins.length)return null;let D=this.painter,ht=D.getFramePainter(),L=D.get3DToolTip(this.bins[R]),ct=ht.grx(D.getAxis("x").GetBinCoord(L.ix-.5)),pt=ht.gry(D.getAxis("y").GetBinCoord(L.iy-.5)),_t=ht.grz(D.getAxis("z").GetBinCoord(L.iz-.5)),Q=this.use_scale?Math.pow(Math.abs(L.value*this.use_scale),.3333):1;return L.x1=ct-this.scalex*Q,L.x2=ct+this.scalex*Q,L.y1=pt-this.scaley*Q,L.y2=pt+this.scaley*Q,L.z1=_t-this.scalez*Q,L.z2=_t+this.scalez*Q,L.color=this.tip_color,L},e.toplevel.add(s),$[r]>0){let z=this.v7EvalColor("line_color","lightblue"),R=new O.nls({color:z}),D=null;D=1===$[r]?(0,H.Qy)(q[r],R,st[r]):(0,H.Qy)(rt[r],R),e.toplevel.add(D)}}l&&this.updatePaletteDraw()}draw3D(){if(!this.draw_content)return!1;let t=this.prepareDraw({only_indexes:!0,extra:-.5,right_extra:-1});return(this.options.Scatter?this.draw3DScatter(t):Promise.resolve(!1)).then(e=>e||this.draw3DBins(t))}redraw(t){let i=this.getFramePainter();return"resize"==t?(i.resize3D()&&i.render3D(),this):((0,Bt.g_)(i),i.create3DScene(this.options.Render3D).then(()=>(i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,bt.C,{zoom:xt.settings.Zooming,ndim:3,draw:!0,v7:!0}),this.drawingBins(t))).then(()=>this.draw3D()).then(()=>(i.render3D(),i.addKeysHandler(),this)))}fillToolbar(){let t=this.getPadPainter();!t||(t.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&t.addPadButton("statbox","Toggle stat box","ToggleStatBox"),t.showPadButtons())}canZoomInside(t,i,e){let n=this.getHisto();return n&&(n=n["f"+t.toUpperCase()+"axis"]),!n||n.FindBin(e,.5)-n.FindBin(i,0)>1}autoZoom(){let l,x,g,t=this.getSelectIndex("x","left"),i=this.getSelectIndex("x","right"),e=this.getSelectIndex("y","left"),n=this.getSelectIndex("y","right"),o=this.getSelectIndex("z","left"),h=this.getSelectIndex("z","right"),m=this.getHisto();if(t===i||e===n||o===h)return;let p=m.getBinContent(t+1,e+1,o+1);for(l=t;l<i;++l)for(x=e;x<n;++x)for(g=o;g<h;++g)p=Math.min(p,m.getBinContent(l+1,x+1,g+1));if(p>0)return;let B=i,c=t,f=n,d=e,y=h,C=o;for(l=t;l<i;++l)for(x=e;x<n;++x)for(g=o;g<h;++g)m.getBinContent(l+1,x+1,g+1)>p&&(l<B&&(B=l),l>=c&&(c=l+1),x<f&&(f=x),x>=d&&(d=x+1),g<y&&(y=g),g>=C&&(C=g+1));let I,_,M,v,T,S,j=!1;return B===c-1&&B>t+1&&c<i-1&&(B--,c++),f===d-1&&f>e+1&&d<n-1&&(f--,d++),y===C-1&&y>o+1&&C<h-1&&(y--,C++),(B>t||c<i)&&B<c-1&&(I=this.getAxis("x").GetBinLowEdge(B+1),_=this.getAxis("x").GetBinLowEdge(c+1),j=!0),(f>e||d<n)&&f<d-1&&(M=this.getAxis("y").GetBinLowEdge(f+1),v=this.getAxis("y").GetBinLowEdge(d+1),j=!0),(y>o||C<h)&&y<C-1&&(T=this.getAxis("z").GetBinLowEdge(y+1),S=this.getAxis("z").GetBinLowEdge(C+1),j=!0),j?this.getFramePainter().zoom(I,_,M,v,T,S):void 0}fillHistContextMenu(t){let i=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",i,e=>{if("inspect"===e)return this.showInspector();this.decodeOptions(e),this.interactiveRedraw(!0,"drawopt")})}static draw(t,i){let e=new J(t,i);return e.mode3d=!0,(0,yt.ensureRCanvas)(e,"3d").then(()=>{e.setAsMainPainter(),e.options={Box:0,Scatter:!1,Sphere:0,Color:!1,minimum:-1111,maximum:-1111};let n=e.v7EvalAttr("kind",""),o=e.v7EvalAttr("sub",0),h=e.options;switch(n){case"box":h.Box=10+o;break;case"sphere":h.Sphere=10+o;break;case"col":h.Color=!0;break;case"scat":h.Scatter=!0;break;default:h.Box=10}return e.scanContent(),e.redraw()})}}function Ct(tt,t,i){return t?1==t.fAxes.length?zt.RH1Painter.draw(tt,t,i):2==t.fAxes.length?At.RH2Painter.draw(tt,t,i):3==t.fAxes.length?J.draw(tt,t,i):null:null}}}]);