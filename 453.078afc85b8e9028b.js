"use strict";(self.webpackChunkFCCViewer=self.webpackChunkFCCViewer||[]).push([[453],{7453:(mt,nt,P)=>{P.r(nt),P.d(nt,{RH1Painter:()=>tt});var T=P(8428),at=P(8681),Y=P(2944),dt=P(1518),ut=P(7527);class q extends dt.n{constructor(t,i){super(t,i),this.wheel_zoomy=!1}scanContent(t){let i=this.getHisto();if(!i)return;!this.nbinsx&&t&&(t=!1),t||this.extractAxesProperties(1);let e=0,g=0,r=0,h=0;if(this.isDisplayItem())e=i.fContMin,g=i.fContMinPos,r=i.fContMax,h=r;else{let l=this.getSelectIndex("x","left"),n=this.getSelectIndex("x","right");if(t&&l===this.scan_xleft&&n===this.scan_xright)return;this.scan_xleft=l,this.scan_xright=n;let a,f,v=!0;for(let s=0;s<this.nbinsx;++s)a=i.getBinContent(s+1),h+=a,!(s<l||s>=n)&&(a>0&&(0==g||a<g)&&(g=a),v&&(e=r=a,v=!1),f=0,e=Math.min(e,a-f),r=Math.max(r,a+f))}if(this.stat_entries=h,this.hmin=e,this.hmax=r,this.ymin_nz=g,this.draw_content=!(0==this.nbinsx||Math.abs(e)<1e-300&&Math.abs(r)<1e-300),this.draw_content)if(e>=r)0==e?(this.ymin=0,this.ymax=1):e<0?(this.ymin=2*e,this.ymax=0):(this.ymin=0,this.ymax=2*e);else{let l=.05*(r-e);this.ymin=e-l,this.ymin<0&&e>=0&&(this.ymin=0),this.ymax=r+l}}countStat(t){let f,i=this.getHisto(),e=this.getAxis("x"),g=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),h=0,l=0,n=0,s=0,u=0,y=null,o=null,w=this.getFramePainter(),m={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(f=g;f<r;++f)s=e.GetBinCoord(f+.5),(!t||t(s))&&(u=i.getBinContent(f+1),(null===y||u>o)&&(y=s,o=u),h+=u,l+=u*s,n+=u*s**2);return!w.isAxisZoomed("x")&&i.fTsumw&&(h=i.fTsumw,l=i.fTsumwx,n=i.fTsumwx2),m.integral=h,h>0&&(m.meanx=l/h,m.meany=0/h,m.rmsx=Math.sqrt(Math.abs(n/h-m.meanx**2)),m.rmsy=Math.sqrt(Math.abs(0/h-m.meany**2))),null!==y&&(m.xmax=y,m.wmax=o),m}fillStatistic(t,i){let e=this.countStat(),g=i%10,r=Math.floor(i/10)%10,h=Math.floor(i/100)%10,l=Math.floor(i/1e3)%10,n=Math.floor(i/1e4)%10,v=Math.floor(i/1e5)%10,a=Math.floor(i/1e6)%10,f=Math.floor(i/1e7)%10,s=Math.floor(i/1e8)%10;return t.clearStat(),g>0&&t.addText(e.name),r>0&&t.addText("Entries = "+t.format(e.entries,"entries")),h>0&&t.addText("Mean = "+t.format(e.meanx)),l>0&&t.addText("Std Dev = "+t.format(e.rmsx)),n>0&&t.addText("Underflow = "+t.format(histo.getBinContent(0),"entries")),v>0&&t.addText("Overflow = "+t.format(histo.getBinContent(this.nbinsx+1),"entries")),a>0&&t.addText("Integral = "+t.format(e.integral,"entries")),f>0&&t.addText("Skew = <not avail>"),s>0&&t.addText("Kurt = <not avail>"),!0}drawBars(t,i,e,g){this.createG(!0);let f,s,u,y,o,w,m,c,x,r=t.i1,h=t.i2,l=t.stepi,n=this.getFramePainter(),v=this.getHisto(),a=this.getAxis("x"),p="",M="",_="";for(c=n.swap_xy?0:g,Number.isFinite(this.options.BaseLine)&&this.options.BaseLine>=i.scale_ymin&&(c=Math.round(i.gry(this.options.BaseLine))),f=r;f<h;f+=l)s=a.GetBinCoord(f),u=a.GetBinCoord(f+l),!(i.logx&&u<=0)&&(y=Math.round(i.grx(s)),o=Math.round(i.grx(u)),w=v.getBinContent(f+1),!(i.logy&&w<i.scale_ymin)&&(m=Math.round(i.gry(w)),x=o-y,y+=Math.round(this.options.BarOffset*x),x=Math.round(this.options.BarWidth*x),p+=n.swap_xy?"M"+c+","+y+"h"+(m-c)+"v"+x+"h"+(c-m)+"z":"M"+y+","+m+"h"+x+"v"+(c-m)+"h"+-x+"z",this.options.BarStyle>0&&(o=y+x,x=Math.round(x/10),n.swap_xy?(M+="M"+c+","+y+"h"+(m-c)+"v"+x+"h"+(c-m)+"z",_+="M"+c+","+o+"h"+(m-c)+"v"+-x+"h"+(c-m)+"z"):(M+="M"+y+","+m+"h"+x+"v"+(c-m)+"h"+-x+"z",_+="M"+o+","+m+"h"+-x+"v"+(c-m)+"h"+x+"z"))));return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),p.length>0&&this.draw_g.append("svg:path").attr("d",p).call(this.fillatt.func),M.length>0&&this.draw_g.append("svg:path").attr("d",M).call(this.fillatt.func).style("fill",(0,at.B8)(this.fillatt.color).brighter(.5).formatHex()),_.length>0&&this.draw_g.append("svg:path").attr("d",_).call(this.fillatt.func).style("fill",(0,at.B8)(this.fillatt.color).darker(.5).formatHex()),Promise.resolve(!0)}drawFilledErrors(t,i){this.createG(!0);let n,v,a,f,s,u,y,e=t.i1,g=t.i2,r=t.stepi,h=this.getHisto(),l=this.getAxis("x"),o=[],w=[];for(n=e;n<g;n+=r)v=l.GetBinCoord(n+.5),!(i.logx&&v<=0)&&(a=Math.round(i.grx(v)),f=h.getBinContent(n+1),s=h.getBinError(n+1),!(i.logy&&f-s<i.scale_ymin)&&(u=Math.round(i.gry(f+s)),y=Math.round(i.gry(f-s)),o.push({grx:a,gry:u}),w.unshift({grx:a,gry:y})));let m=4===this.options.ErrorKind?"bezier":"line",c=(0,Y.Cq)(m,o),x=(0,Y.Cq)("L"+m,w);return this.fillatt.empty()&&this.fillatt.setSolidColor("blue"),this.draw_g.append("svg:path").attr("d",c.path+x.path+"Z").call(this.fillatt.func),Promise.resolve(!0)}draw1DBins(){let t=this.getFramePainter(),i=t.getFrameRect();if(!this.draw_content||i.width<=0||i.height<=0)return this.removeG(),Promise.resolve(!1);this.createHistDrawAttributes();let e=this.prepareDraw({extra:1,only_indexes:!0}),g=t.getGrFuncs(this.options.second_x,this.options.second_y);return this.options.Bar?this.drawBars(e,g,i.width,i.height):3===this.options.ErrorKind||4===this.options.ErrorKind?this.drawFilledErrors(e,g,i.width,i.height):this.drawHistBins(e,g,i.width,i.height)}drawHistBins(t,i,e,g){this.createG(!0);let y,o,w,m,c,x,p,M,_,S,E,b,B,d,A,L,U,z,rt,I,O,R,k,r=this.options,h=t.i1,l=t.i2,n=t.stepi,v=this.getHisto(),a=!(0,T.isBatchMode)()&&T.settings.Tooltip,f=this.getAxis("x"),s="",u=!1,C=!r.Zero,H=r.Error,G=r.Mark,X=r.Line,N=r.Text,W=null,Z=null,$=null,K=null,j=null,it="",et="",J=0;if(H&&!G&&this.v7EvalAttr("marker_style",1)>1&&(G=!0),2===r.ErrorKind?this.fillatt.empty()?G=!0:W="":r.Error&&(Z="",j=a?"":null),X&&(K=""),G&&(this.createv7AttMarker(),this.markeratt.size>0?($="",this.markeratt.resetPos()):G=!1),N){if(k=this.v7EvalFont("text",{size:20,color:"black",align:22}),!k.angle&&!r.TextKind){let D=e/(l-h+1);D<3*k.size&&(k.setAngle(270),k.setSize(Math.round(.7*D)))}this.startTextDrawing(k,"font")}let ot=l-h>3*e;if(1===r.ErrorKind){let D=this.lineatt.width+T.gStyle.fEndErrorSize;it="m0,"+D+"v-"+2*D+"m0,"+D,et="m"+D+",0h-"+2*D+"m"+D+",0",J=Math.floor((this.lineatt.width-1)/2)}let V=H||G;(V||N||X)&&(ot=!0);let Q=D=>{if(z=v.getBinContent(D+1),!C||0!==z){if(I=Math.round(i.grx(f.GetBinCoord(D))),O=Math.round(i.grx(f.GetBinCoord(D+n))),R=Math.round((I+O)/2),A=Math.round(i.gry(z)),L=U=20,H&&(rt=v.getBinError(D+1),L=Math.round(A-i.gry(z+rt)),U=Math.round(i.gry(z-rt)-A)),N&&0!==z){let F=z===Math.round(z)?z.toString():(0,Y.Ee)(z,T.gStyle.fPaintTextFormat);this.drawText(k.angle?{align:12,x:R,y:Math.round(A-2-k.size/5),text:F,latex:0}:{x:Math.round(I+.1*(O-I)),y:Math.round(A-2-k.size),width:Math.round(.8*(O-I)),height:k.size,text:F,latex:0})}if(X&&null!==K&&(K+=(0===K.length?"M":"L")+R+","+A),V&&A>=-L&&A<=g+U&&(null!==W&&(W+="M"+I+","+(A-L)+"h"+(O-I)+"v"+(L+U+1)+"h-"+(O-I)+"z"),null!==$&&($+=this.markeratt.create(R,A)),null!==Z)){let F=5;if(this.options.errorX>0){F=Math.round((O-I)*this.options.errorX);let ft=R-F;Z+="M"+(ft+J)+","+A+it+"h"+(R+F-ft-2*J)+it}Z+="M"+R+","+(A-L+J)+et+"v"+(L+U-2*J)+et,null!==j&&(j+="M"+(R-F)+","+(A-L)+"h"+2*F+"v"+(L+U)+"h"+-2*F+"z")}}};for(b=h;b<=l;b+=n)m=f.GetBinCoord(b),!(i.logx&&m<=0)&&(c=Math.round(i.grx(m)),u=b>l-n,u&&h<l?p=w:(x=v.getBinContent(b+1),p=Math.round(i.gry(x))),0===s.length?(B=d=b,E=y=o=c,S=M=_=w=p,s="M"+o+","+w):ot?c!==o||u?((V||N||X)&&(B===d?Q(B):B<d?(Q(B),Q(d)):(Q(d),Q(B))),!V&&(M!==_||S!==M)&&(E!==o&&(s+="h"+(o-E)),w===M?(_!==S&&(s+="v"+(_-S)),M!==_&&(s+="v"+(M-_))):(M!==S&&(s+="v"+(M-S)),_!==M&&(s+="v"+(_-M)),w!==_&&(s+="v"+(w-_))),E=o,S=w),u&&E!==c&&(s+="h"+(c-E)),B=d=b,M=_=w=p,o=c):(p<M?d=b:p>_&&(B=b),M=Math.min(M,p),_=Math.max(_,p),w=p):(p!==w||u)&&(c!==o&&(s+="h"+(c-o)),p!==w&&(s+="v"+(p-w)),w=p,o=c));let st="",ht=!(0,T.isBatchMode)()&&this.fillatt.empty()&&r.Hist&&T.settings.Tooltip&&!V&&!X;if(!this.fillatt.empty()||ht){let D=g+3;if(ht){let F=Math.round(i.gry(0));F<=0?D=-3:F<g&&(D=F)}st=`L${o},${D}H${y}Z`,s.length>0&&(s+=st)}return V||X?(null!==W&&W.length>0&&this.draw_g.append("svg:path").attr("d",W).call(this.fillatt.func),null!==Z&&Z.length>0&&this.draw_g.append("svg:path").attr("d",Z).call(this.lineatt.func),null!==j&&j.length>0&&this.draw_g.append("svg:path").attr("d",j).style("fill","none").style("pointer-events",(0,T.isBatchMode)()?null:"visibleFill"),null!==K&&K.length>0&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",r.Fill?K+st:s).call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",K).style("fill","none").call(this.lineatt.func)),null!==$&&$.length>0&&this.draw_g.append("svg:path").attr("d",$).call(this.markeratt.func)):s&&r.Hist&&this.draw_g.append("svg:path").attr("d",s).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func),N?this.finishTextDrawing():Promise.resolve(!0)}getBinTooltips(t){let i=[],e=this.getObjectHint(),g=this.getFramePainter(),r=this.getHisto(),h=this.getAxis("x"),l=this.isDisplayItem()?r.stepx:1,n=h.GetBinCoord(t),v=h.GetBinCoord(t+l),a=r.getBinContent(t+1),f=this.getAxisBinTip("x",t,l);if(e.length>0&&i.push(e),this.options.Error||this.options.Mark)i.push("x = "+f),i.push("y = "+g.axisAsText("y",a)),this.options.Error&&("["==f[0]&&i.push("error x = "+((v-n)/2).toPrecision(4)),i.push("error y = "+r.getBinError(t+1).toPrecision(4)));else{i.push("bin = "+t),i.push("x = "+f),r.$baseh&&(a-=r.$baseh.getBinContent(t+1));let s="entries = "+(l>1?"~":"");a===Math.round(a)?i.push(s+a):i.push(s+(0,Y.Ee)(a,T.gStyle.fStatFormat))}return i}processTooltipEvent(t){if(!t||!this.draw_content||this.options.Mode3D||!this.draw_g)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;let v,a,f,s,u,y,o,i=this.getFramePainter(),e=i.getGrFuncs(this.options.second_x,this.options.second_y),g=i.getFrameWidth(),r=i.getFrameHeight(),h=this.getHisto(),l=this.getAxis("x"),n=null,w=2,m=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",2),x=m,p=c;function M(d){let C=l.GetBinCoord(d);return e.logx&&C<=0?null:e.grx(C)}function _(d){let C=h.getBinContent(d+1);return e.logy&&C<e.scale_ymin?e.swap_xy?-1e3:10*r:Math.round(e.gry(C))}let S=e.swap_xy?t.y:t.x,E=e.swap_xy?t.x:t.y;for(;x<p-1;){let d=Math.round(.5*(x+p)),C=M(d);null===C||C<S-.5?e.swap_xy?p=d:x=d:C>S+.5?e.swap_xy?x=d:p=d:(x++,p--)}if(n=p=x,a=M(n),e.swap_xy){for(;x>m&&M(x-1)<a+2;)--x;for(;p<c&&M(p+1)>a-2;)++p}else{for(;x>m&&M(x-1)>a-2;)--x;for(;p<c&&M(p+1)<a+2;)++p}if(x<p){let d=r;for(let C=x;C<=p;C++){let H=Math.abs(_(C)-E);H<d&&(d=H,n=C)}d>r/10&&(n=Math.round(x+(p-x)/r*E)),a=M(n)}if(a=Math.round(a),s=Math.round(M(n+1)),this.options.Bar){let d=s-a;a+=Math.round(this.options.BarOffset*d),s=a+Math.round(this.options.BarWidth*d)}if(a>s){let d=a;a=s,s=d}if(f=Math.round((a+s)/2),y=u=o=_(n),this.options.Bar){if(v=!0,w=0,u=Math.round(e.gry(!1!==this.options.BaseLine&&this.options.BaseLine>e.scale_ymin?this.options.BaseLine:e.scale_ymin)),u>o){let d=u;u=o,o=d}!t.touch&&1===t.nproc&&(E<u||E>o)&&(n=null)}else if(this.options.Error||this.options.Mark){v=!0;let d=3;if(this.markeratt&&(d=Math.max(d,this.markeratt.getFullSize())),this.options.Error){let C=h.getBinContent(n+1),H=h.getBinError(n+1);u=Math.round(e.gry(C+H)),o=Math.round(e.gry(C-H));let G=(s-a)*this.options.errorX;a=Math.round(f-G),s=Math.round(f+G)}s-a<2*d&&(a=f-d,s=f+d),u=Math.min(u,y-d),o=Math.max(o,y+d),!t.touch&&1===t.nproc&&(E<u||E>o)&&(n=null)}else if(this.options.Line)v=!1;else if(v=1===t.nproc&&c-m<g,v){if(o=r,!this.fillatt.empty()&&(o=Math.round(e.gry(0)),o<0?o=0:o>r&&(o=r),o<u)){let d=u;u=o,o=d}(t.y<u||t.y>o)&&!t.touch&&(n=null)}null!==n&&(n===m&&a>S+w||n===c-1&&s<S-w||S<a-w||S>s+w||!this.options.Zero&&0===h.getBinContent(n+1))&&(n=null);let b=this.draw_g.select(".tooltip_bin");if(null===n||o<=0||u>=r)return b.remove(),null;let B={name:"histo",title:h.fTitle,x:f,y,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(n)};if(t.disabled)b.remove(),B.changed=!0;else if(v)b.empty()&&(b=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),B.changed=b.property("current_bin")!==n,B.changed&&b.attr("x",i.swap_xy?u:a).attr("width",i.swap_xy?o-u:s-a).attr("y",i.swap_xy?a:u).attr("height",i.swap_xy?s-a:o-u).style("opacity","0.3").property("current_bin",n),B.exact=Math.abs(y-E)<=5||E>=u&&E<=o,B.menu=B.exact,B.menu_dist=Math.sqrt((f-S)**2+(y-E)**2);else{let d=this.lineatt.width+3;b.empty()&&(b=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",d).call(this.lineatt.func).call(this.fillatt.func)),B.exact=Math.abs(f-t.x)<=d&&Math.abs(y-t.y)<=d,B.menu=B.exact,B.menu_dist=Math.sqrt((f-t.x)**2+(y-t.y)**2),B.changed=b.property("current_bin")!==n,B.changed&&b.attr("cx",f).attr("cy",y).property("current_bin",n)}return B.changed&&(B.user_info={obj:h,name:"histo",bin:n,cont:h.getBinContent(n+1),grx:f,gry:y}),B}fillHistContextMenu(t){t.add("Auto zoom-in",()=>this.autoZoom());let i=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",i,e=>{if("inspect"===e)return this.showInspector();this.decodeOptions(e),this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.change(5,1001),this.interactiveRedraw("pad","drawopt")})}autoZoom(){let t=this.getSelectIndex("x","left",-1),i=this.getSelectIndex("x","right",1),e=i-t,g=this.getHisto(),r=this.getAxis("x");if(0==e)return;let h=g.getBinContent(t+1);for(let l=t;l<i;++l)h=Math.min(h,g.getBinContent(l+1));if(!(h>0)){for(;t<i&&g.getBinContent(t+1)<=h;)++t;for(;t<i&&g.getBinContent(i)<=h;)--i;if(t===i-1&&t>2&&i<this.nbinsx-2&&(--t,++i),i-t<e&&t<i)return this.getFramePainter().zoom(r.GetBinCoord(t),r.GetBinCoord(i))}}canZoomInside(t,i,e){let g=this.getAxis("x");return"x"==t&&g.FindBin(e,.5)-g.FindBin(i,0)>1||"y"==t&&Math.abs(e-i)>1e-6*Math.abs(this.ymax-this.ymin)}callDrawFunc(t){let i=this.getFramePainter();return i&&i.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=i.mode3d),this.options.Mode3D?this.draw3D(t):this.draw2D(t)}draw2D(t){return this.clear3DScene(),this.drawFrameAxes().then(i=>!!i&&this.drawingBins(t)).then(i=>{if(i)return this.draw1DBins().then(()=>this.addInteractivity())}).then(()=>this)}draw3D(t){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),this.draw2D(t)}redraw(t){return this.callDrawFunc(t)}static _draw(t,i){return(0,ut.ensureRCanvas)(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:T.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1};let e=new Y.pc(i);e.check("R3D_",!0)&&(t.options.Render3D=T.constants.Render3D.fromString(e.part.toLowerCase()));let g=t.v7EvalAttr("kind","hist"),r=t.v7EvalAttr("sub",0),h=!!t.getMainPainter(),l=t.options;switch(l.Text=t.v7EvalAttr("drawtext",!1),l.BarOffset=t.v7EvalAttr("baroffset",0),l.BarWidth=t.v7EvalAttr("barwidth",1),l.second_x=h&&t.v7EvalAttr("secondx",!1),l.second_y=h&&t.v7EvalAttr("secondy",!1),g){case"bar":l.Bar=!0,l.BarStyle=r;break;case"err":l.Error=!0,l.ErrorKind=r;break;case"p":l.Mark=!0;break;case"l":l.Line=!0;break;case"lego":l.Lego=r>0?10+r:12,l.Mode3D=!0;break;default:l.Hist=!0}return t.scanContent(),t.callDrawFunc()})}static draw(t,i,e){return q._draw(new q(t,i),e)}}var xt=P(9232),lt=P(8415);class tt extends q{draw3D(t){this.mode3d=!0;let i=this.getFramePainter(),e=this.isMainPainter(),g=1+2*T.gStyle.fHistTopMargin,r=Promise.resolve(this);return"resize"==t?(e&&i.resize3D()&&i.render3D(),r):(this.deleteAttr(),this.scanContent(!0),e&&((0,lt.g_)(i),r=i.create3DScene(this.options.Render3D).then(()=>{i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,null,this.ymin,this.ymax,null,0,0),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,xt.C,{use_y_for_z:!0,zmult:g,zoom:T.settings.Zooming,ndim:1,draw:!0,v7:!0})})),i.mode3d?r.then(()=>this.drawingBins(t)).then(()=>{let h=this.getFramePainter();return(0,lt.UR)(this,!0),this.updatePaletteDraw(),h.render3D(),h.addKeysHandler(),this}):r)}static draw(t,i,e){return tt._draw(new tt(t,i),e)}}}}]);